<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#e0f2fe">
    <title>세계평화통일가정연합 - 말씀 퀴즈</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            transition: font-size 0.3s ease;
        }

        html.font-large {
            font-size: 18px;
        }

        html.font-extra-large {
            font-size: 20px;
        }

        body {
            font-family: 'Noto Sans KR', 'Arial', sans-serif;
            background: linear-gradient(135deg, #e0f2fe, #f8fafc);
            color: #1e3a8a;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-font-smoothing: antialiased;
            -webkit-overflow-scrolling: touch;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1e3a8a, #2d3748);
            color: #e0f2fe;
        }

        body.high-contrast {
            background: #ffffff;
            color: #000000;
        }

        body.dark-mode.high-contrast {
            background: #000000;
            color: #ffffff;
        }

        body.dark-mode .header,
        body.dark-mode .nav-bar,
        body.dark-mode .search-container,
        body.dark-mode .instructions,
        body.dark-mode .footer,
        body.dark-mode .result-item,
        body.dark-mode .onboarding-tip {
            background: #2d3748;
            color: #e0f2fe;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body.high-contrast .header,
        body.high-contrast .nav-bar,
        body.high-contrast .search-container,
        body.high-contrast .instructions,
        body.high-contrast .footer,
        body.high-contrast .result-item,
        body.high-contrast .onboarding-tip {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast .header,
        body.dark-mode.high-contrast .nav-bar,
        body.dark-mode.high-contrast .search-container,
        body.dark-mode.high-contrast .instructions,
        body.dark-mode.high-contrast .footer,
        body.dark-mode.high-contrast .result-item,
        body.dark-mode.high-contrast .onboarding-tip {
            background: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
        }

        body.dark-mode .search-box input,
        body.dark-mode .search-suggestions {
            background: #4b5563;
            color: #e0f2fe;
            border-color: #60a5fa;
        }

        body.high-contrast .search-box input,
        body.high-contrast .search-suggestions {
            background: #ffffff;
            color: #000000;
            border-color: #000000;
        }

        body.dark-mode.high-contrast .search-box input,
        body.dark-mode.high-contrast .search-suggestions {
            background: #000000;
            color: #ffffff;
            border-color: #ffffff;
        }

        .nav-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin: 1rem 0;
            width: 100%;
            max-width: 40rem;
            background: #ffffff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0.5rem;
            z-index: 100;
        }

        .nav-bar button {
            background: #1e3a8a;
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 8rem;
            touch-action: manipulation;
        }

        body.dark-mode .nav-bar button {
            background: #60a5fa;
        }

        body.high-contrast .nav-bar button {
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast .nav-bar button {
            background: #ffffff;
            color: #000000;
            border: 2px solid #ffffff;
        }

        .nav-bar button.active {
            background: #d4af37;
            transform: scale(1.05);
        }

        .nav-bar button:hover:not(.active) {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .accessibility-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .accessibility-controls button {
            background: #6b7280;
            padding: 0.75rem;
            min-width: 0;
        }

        .accessibility-controls button:hover {
            background: #9ca3af;
        }

        body.dark-mode .accessibility-controls button {
            background: #9ca3af;
        }

        body.high-contrast .accessibility-controls button {
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast .accessibility-controls button {
            background: #ffffff;
            color: #000000;
            border: 2px solid #ffffff;
        }

        .page-container {
            width: 100%;
            max-width: 40rem;
            flex: 1;
        }

        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }

        .page.active {
            display: flex;
        }

        .header {
            margin: 1rem 0;
            padding: 1.5rem;
            background: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center;
        }

        .header img {
            width: 5rem;
            height: auto;
            border-radius: 50%;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }

        .header img:hover {
            transform: scale(1.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0d47a1;
            margin-bottom: 0.5rem;
        }

        .header h2 {
            font-size: 1.4rem;
            font-weight: 500;
            color: #1e3a8a;
            margin-bottom: 0.75rem;
        }

        .header p {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
        }

        body.dark-mode .header h1,
        body.dark-mode .header h2,
        body.dark-mode .instructions h2,
        body.dark-mode .search-container h2 {
            color: #bbdefb;
        }

        body.high-contrast .header h1,
        body.high-contrast .header h2,
        body.high-contrast .instructions h2,
        body.high-contrast .search-container h2 {
            color: #000000;
        }

        body.dark-mode.high-contrast .header h1,
        body.dark-mode.high-contrast .header h2,
        body.dark-mode.high-contrast .instructions h2,
        body.dark-mode.high-contrast .search-container h2 {
            color: #ffffff;
        }

        body.dark-mode .header p,
        body.dark-mode .instructions ul,
        body.dark-mode .result-item p,
        body.dark-mode .footer,
        body.dark-mode .onboarding-tip {
            color: #d1d5db;
        }

        body.high-contrast .header p,
        body.high-contrast .instructions ul,
        body.high-contrast .result-item p,
        body.high-contrast .footer,
        body.high-contrast .onboarding-tip {
            color: #000000;
        }

        body.dark-mode.high-contrast .header p,
        body.dark-mode.high-contrast .instructions ul,
        body.dark-mode.high-contrast .result-item p,
        body.dark-mode.high-contrast .footer,
        body.dark-mode.high-contrast .onboarding-tip {
            color: #ffffff;
        }

        .divider {
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
            margin: 1rem auto;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1.5rem 0;
            width: 100%;
        }

        button.quiz-button {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 3.5rem;
        }

        button.quiz-button.gold {
            background: linear-gradient(135deg, #d4af37, #facc15);
        }

        body.high-contrast button.quiz-button {
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast button.quiz-button {
            background: #ffffff;
            color: #000000;
            border: 2px solid #ffffff;
        }

        button.quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button.quiz-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e3a8a;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
            margin-bottom: 0.5rem;
        }

        button.quiz-button:hover::after {
            opacity: 1;
        }

        .search-container {
            width: 100%;
            background: #ffffff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 1rem 0;
        }

        .search-container h2 {
            font-size: 1.4rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            position: relative;
        }

        .search-box input {
            flex: 1;
            padding: 0.75rem;
            font-size: 1rem;
            border: 2px solid #1e3a8a;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.3s ease;
            min-height: 2.5rem;
        }

        .search-box input:focus {
            border-color: #d4af37;
        }

        .search-box button, .clear-search {
            width: 2.5rem;
            height: 2.5rem;
            background: #1e3a8a;
            color: white;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-search {
            background: #6b7280;
        }

        body.high-contrast .search-box button,
        body.high-contrast .clear-search {
            background: #000000;
            color: #ffffff;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast .search-box button,
        body.dark-mode.high-contrast .clear-search {
            background: #ffffff;
            color: #000000;
            border: 2px solid #ffffff;
        }

        .search-box button:hover, .clear-search:hover {
            transform: translateY(-2px);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #d4af37;
            border-radius: 0.5rem;
            max-height: 10rem;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .search-suggestions div {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 1rem;
        }

        .search-suggestions div:hover {
            background: #e0f2fe;
        }

        body.dark-mode .search-suggestions div:hover {
            background: #60a5fa;
        }

        .search-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            justify-content: center;
        }

        .search-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: #444;
            cursor: pointer;
        }

        .search-options input[type="checkbox"] {
            accent-color: #1e3a8a;
            width: 1.2rem;
            height: 1.2rem;
        }

        .category-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 0.75rem;
        }

        .category-container button {
            background: #6b7280;
            color: white;
            font-size: 1rem;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 2.5rem;
        }

        .category-container button.active {
            background: #d4af37;
        }

        .category-container button:hover:not(.active) {
            background: #1e3a8a;
        }

        .search-stats {
            font-size: 1rem;
            color: #444;
            background: #f3f4f6;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .result-item {
            background: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: left;
            position: relative;
        }

        .result-item h3 {
            font-size: 1.2rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 0.5rem;
        }

        .result-item p {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
        }

        .result-item .source {
            font-size: 0.9rem;
            color: #1e3a8a;
            font-style: italic;
            margin-top: 0.5rem;
        }

        .highlight {
            background: #fef3c7;
            color: #92400e;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }

        .match-count {
            background: #1e3a8a;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            margin-left: 0.5rem;
            font-size: 0.9rem;
        }

        .no-results {
            color: #b91c1c;
            font-size: 1rem;
            padding: 1rem;
            background: #fee2e2;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .no-results button {
            background: #1e3a8a;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: #1e3a8a;
            margin: 1rem 0;
        }

        .loading .spinner {
            width: 1.2rem;
            height: 1.2rem;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar div {
            width: 0;
            height: 100%;
            background: #1e3a8a;
            transition: width 0.3s ease;
        }

        .instructions {
            margin: 1rem 0;
            width: 100%;
            background: #ffffff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            font-size: 1.4rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 0.75rem;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
            text-align: left;
            font-size: 1rem;
            color: #444;
        }

        .instructions li {
            margin: 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructions i {
            color: #1e3a8a;
            font-size: 1.2rem;
        }

        .footer {
            margin-top: auto;
            padding: 1rem;
            background: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 40rem;
            font-size: 1rem;
            color: #444;
            text-align: center;
        }

        .back-to-top {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: #1e3a8a;
            color: white;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .back-to-top:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .magnifier-overlay {
            position: fixed;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #1e3a8a;
            border-radius: 0.5rem;
            padding: 0.5rem;
            font-size: 1.5rem;
            line-height: 1.4;
            z-index: 1000;
            display: none;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .magnifier-overlay {
            background: rgba(45, 55, 72, 0.9);
            color: #e0f2fe;
            border-color: #60a5fa;
        }

        body.high-contrast .magnifier-overlay {
            background: #ffffff;
            color: #000000;
            border-color: #000000;
        }

        body.dark-mode.high-contrast .magnifier-overlay {
            background: #000000;
            color: #ffffff;
            border-color: #ffffff;
        }

        .onboarding-tip {
            background: #e0f2fe;
            color: #1e3a8a;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .onboarding-tip button {
            background: #1e3a8a;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            position: absolute;
            right: 1rem;
        }

        body.dark-mode .onboarding-tip {
            background: #4b5563;
            color: #e0f2fe;
        }

        body.high-contrast .onboarding-tip {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        body.dark-mode.high-contrast .onboarding-tip {
            background: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
        }

        @media (min-width: 768px) {
            .nav-bar {
                padding: 1.25rem;
            }
            .nav-bar button {
                font-size: 1.2rem;
                padding: 0.75rem 2rem;
            }
            .header h1 {
                font-size: 2.2rem;
            }
            .header h2 {
                font-size: 1.6rem;
            }
            .header p {
                font-size: 1.1rem;
            }
            .header img {
                width: 6rem;
            }
            .button-container {
                flex-direction: row;
                justify-content: center;
                gap: 1rem;
            }
            button.quiz-button {
                width: 12rem;
            }
            .search-container h2 {
                font-size: 1.6rem;
            }
            .search-box input {
                font-size: 1.1rem;
            }
            .search-box button, .clear-search {
                width: 3rem;
                height: 3rem;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
            body {
                padding: 0.75rem;
            }
            .nav-bar {
                flex-direction: column;
                align-items: center;
                padding: 0.75rem;
            }
            .nav-bar button {
                width: 100%;
                justify-content: center;
                font-size: 1rem;
                padding: 0.75rem;
            }
            .accessibility-controls {
                flex-direction: column;
                width: 100%;
            }
            .accessibility-controls button {
                width: 100%;
                justify-content: center;
            }
            .header h1 {
                font-size: 1.6rem;
            }
            .header h2 {
                font-size: 1.3rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .header img {
                width: 4rem;
            }
            button.quiz-button {
                font-size: 1.1rem;
                padding: 0.75rem;
            }
            .search-box input {
                font-size: 0.9rem;
            }
            .search-options label,
            .category-container button,
            .search-stats,
            .result-item h3,
            .result-item p {
                font-size: 0.9rem;
            }
            .back-to-top {
                display: flex;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <nav class="nav-bar" aria-label="메인 내비게이션">
        <button data-page="home" class="active" aria-current="page"><i class="fas fa-home"></i> 홈</button>
        <button data-page="workbook"><i class="fas fa-book-open"></i> 말씀 DB</button>
        <div class="accessibility-controls">
            <button onclick="toggleDarkMode()" aria-label="다크 모드 전환" data-tooltip="다크 모드와 라이트 모드를 전환합니다"><i class="fas fa-moon"></i></button>
            <button onclick="toggleHighContrast()" aria-label="고대비 모드 전환" data-tooltip="고대비 모드로 전환하여 시인성을 높입니다"><i class="fas fa-adjust"></i></button>
            <button onclick="changeFontSize('normal')" aria-label="기본 글꼴 크기" data-tooltip="기본 글꼴 크기로 설정합니다">A</button>
            <button onclick="changeFontSize('large')" aria-label="큰 글꼴 크기" data-tooltip="큰 글꼴 크기로 설정하여 읽기 쉽게 합니다">A+</button>
            <button onclick="changeFontSize('extra-large')" aria-label="매우 큰 글꼴 크기" data-tooltip="매우 큰 글꼴 크기로 설정합니다">A++</button>
            <button onclick="toggleMagnifier()" aria-label="돋보기 기능 전환" data-tooltip="텍스트를 확대하여 읽을 수 있는 돋보기 기능을 켭니다"><i class="fas fa-search-plus"></i></button>
            <button onclick="showOnboarding()" aria-label="사용 방법 보기" data-tooltip="앱 사용 방법을 다시 확인합니다"><i class="fas fa-question-circle"></i></button>
        </div>
    </nav>

    <main class="page-container">
        <section class="page active" id="home" role="region" aria-labelledby="home-heading">
            <div class="onboarding-tip" id="onboarding-home" role="alert">
                <i class="fas fa-info-circle"></i> 원리강론 또는 성경 퀴즈를 시작하려면 아래 버튼을 누르세요!
                <button onclick="dismissOnboarding('home')" aria-label="온보딩 메시지 닫기">닫기</button>
            </div>
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="80" height="80">
                </div>
                <h1 id="home-heading">말씀 퀴즈</h1>
                <h2>영감과 지혜의 여정</h2>
                <p>세계평화통일가정연합의 말씀을 통해 영적 성장을 경험하세요.</p>
                <p>퀴즈와 말씀 검색으로 신앙의 깊이를 더하세요.</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="button-container">
                <button class="quiz-button blue" onclick="startQuiz('원리강론')" aria-label="원리강론 퀴즈 시작" data-tooltip="원리강론 퀴즈로 통일원리를 탐구하세요">
                    <i class="fas fa-school"></i> 원리강론 퀴즈
                </button>
                <button class="quiz-button gold" onclick="startQuiz('성경')" aria-label="성경 퀴즈 시작" data-tooltip="성경 말씀으로 신앙을 깊이 이해하세요">
                    <i class="fas fa-cross"></i> 성경 퀴즈
                </button>
            </div>
            <div class="divider" aria-hidden="true"></div>
            <section class="instructions" role="complementary" aria-labelledby="instructions-heading">
                <h2 id="instructions-heading"><i class="fas fa-info-circle"></i> 사용 방법</h2>
                <ul>
                    <li><i class="fas fa-hand-pointer"></i> <strong>퀴즈 시작:</strong> 원리강론 또는 성경 퀴즈 버튼을 누르세요.</li>
                    <li><i class="fas fa-question-circle"></i> <strong>답변 선택:</strong> 문제에 맞는 답을 선택하세요.</li>
                    <li><i class="fas fa-check-circle"></i> <strong>정답 확인:</strong> 답변 후 "정답 확인"을 누르세요.</li>
                    <li><i class="fas fa-arrow-right"></i> <strong>다음 문제:</strong> 다음 문제로 이동합니다.</li>
                    <li><i class="fas fa-search"></i> <strong>말씀 검색:</strong> 말씀 DB에서 원하는 말씀을 검색하세요.</li>
                </ul>
            </section>
        </section>

        <section class="page" id="workbook" role="region" aria-labelledby="workbook-heading">
            <div class="onboarding-tip" id="onboarding-workbook" role="alert">
                <i class="fas fa-info-circle"></i> 검색창에 단어를 입력하거나 카테고리를 선택해 말씀을 찾아보세요!
                <button onclick="dismissOnboarding('workbook')" aria-label="온보딩 메시지 닫기">닫기</button>
            </div>
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="80" height="80">
                </div>
                <h1 id="workbook-heading"><i class="fas fa-book-open"></i> 말씀 데이터베이스</h1>
                <h2>말씀의 보물창고</h2>
                <p>천성경, 통일원리, 성경 등 다양한 말씀을 탐구하세요.</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="search-container">
                <h2><i class="fas fa-search"></i> 말씀 검색</h2>
                <div class="search-box">
                    <label for="search-input" class="sr-only">검색어 입력</label>
                    <input type="text" id="search-input" placeholder="검색어를 입력하세요" aria-label="검색어 입력 필드" autocomplete="off">
                    <div class="search-suggestions" id="search-suggestions"></div>
                    <button onclick="searchMessages()" title="검색 실행" aria-label="검색"><i class="fas fa-search"></i></button>
                    <button class="clear-search" onclick="clearSearch()" title="검색 초기화" aria-label="검색 초기화"><i class="fas fa-times"></i></button>
                </div>
                <div class="search-options" role="group" aria-label="검색 옵션">
                    <label>
                        <input type="checkbox" id="exact-match">
                        <i class="fas fa-quote-left"></i> 정확한 단어
                    </label>
                    <label>
                        <input type="checkbox" id="case-sensitive">
                        <i class="fas fa-font"></i> 대소문자 구분
                    </label>
                    <label>
                        <input type="checkbox" id="whole-word">
                        <i class="fas fa-signature"></i> 전체 단어
                    </label>
                </div>
                <div class="category-container" role="group" aria-label="카테고리 필터">
                    <button class="active" data-category="전체" aria-pressed="true">전체</button>
                    <button data-category="천성경" aria-pressed="false">천성경</button>
                    <button data-category="통일원리" aria-pressed="false">통일원리</button>
                    <button data-category="성경" aria-pressed="false">성경</button>
                    <button data-category="평화메시지" aria-pressed="false">평화메시지</button>
                    <button data-category="기타" aria-pressed="false">기타</button>
                </div>
                <div id="search-stats" class="search-stats" style="display: none;" role="status" aria-live="polite"></div>
            </div>
            <div id="search-loading" class="loading" style="display: none;" aria-live="assertive" aria-atomic="true">
                <div class="spinner" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="검색 중"></div>
                검색 중...
                <div class="progress-bar"><div></div></div>
            </div>
            <div id="search-results" class="search-results" style="display: none;" role="list"></div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <p>© 2025 세계평화통일가정연합. All rights reserved.</p>
    </footer>

    <button class="back-to-top" onclick="scrollToTop()" aria-label="페이지 맨 위로 이동" data-tooltip="페이지 맨 위로 이동합니다"><i class="fas fa-arrow-up"></i></button>
    <div class="magnifier-overlay" id="magnifier-overlay"></div>

    <script>
        let messages = [];
        let currentCategory = localStorage.getItem('currentCategory') || '전체';
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
        let debounceTimeout;
        let currentPage = 1;
        const resultsPerPage = 10;
        let magnifierEnabled = false;

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
            triggerHapticFeedback();
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            localStorage.setItem('highContrast', document.body.classList.contains('high-contrast') ? 'enabled' : 'disabled');
            triggerHapticFeedback();
        }

        function changeFontSize(size) {
            document.documentElement.classList.remove('font-large', 'font-extra-large');
            if (size === 'large') document.documentElement.classList.add('font-large');
            else if (size === 'extra-large') document.documentElement.classList.add('font-extra-large');
            localStorage.setItem('fontSize', size);
            triggerHapticFeedback();
        }

        function toggleMagnifier() {
            magnifierEnabled = !magnifierEnabled;
            const magnifierButton = document.querySelector('button[aria-label="돋보기 기능 전환"]');
            magnifierButton.classList.toggle('active');
            document.getElementById('magnifier-overlay').style.display = magnifierEnabled ? 'block' : 'none';
            triggerHapticFeedback();
        }

        function triggerHapticFeedback() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        function showOnboarding() {
            localStorage.removeItem('onboardingDismissed');
            document.getElementById('onboarding-home').style.display = 'flex';
            document.getElementById('onboarding-workbook').style.display = 'flex';
        }

        function dismissOnboarding(section) {
            document.getElementById(`onboarding-${section}`).style.display = 'none';
            const dismissed = JSON.parse(localStorage.getItem('onboardingDismissed')) || {};
            dismissed[section] = true;
            localStorage.setItem('onboardingDismissed', JSON.stringify(dismissed));
            triggerHapticFeedback();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            triggerHapticFeedback();
        }

        async function loadMessages() {
            const loading = document.getElementById('search-loading');
            const progressBar = document.querySelector('.progress-bar div');
            loading.style.display = 'flex';
            progressBar.style.width = '20%';
            try {
                const response = await fetch('messages.json');
                progressBar.style.width = '60%';
                if (!response.ok) throw new Error('Failed to load messages.json');
                messages = await response.json();
                progressBar.style.width = '100%';
                messages = messages.map(msg => {
                    if (!msg.category) {
                        if (msg.source.includes('천성경')) msg.category = '천성경';
                        else if (msg.source.includes('성경')) msg.category = '성경';
                        else if (msg.source.includes('통일원리')) msg.category = '통일원리';
                        else if (msg.source.includes('평화메시지')) msg.category = '평화메시지';
                        else msg.category = '기타';
                    }
                    return msg;
                });
            } catch (error) {
                console.error('Error loading messages:', error);
                document.getElementById('search-results').innerHTML = `
                    <p class="no-results" role="alert">
                        메시지를 로드하는 데 실패했습니다.
                        <button onclick="loadMessages()" aria-label="다시 시도">다시 시도</button>
                    </p>`;
            } finally {
                setTimeout(() => {
                    loading.style.display = 'none';
                    progressBar.style.width = '0';
                }, 300);
            }
        }

        function highlightText(text, query, isCaseSensitive, isWholeWord) {
            if (!query) return text;
            let regex;
            try {
                const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const pattern = isWholeWord ? `\\b${escapedQuery}\\b` : escapedQuery;
                regex = new RegExp(pattern, isCaseSensitive ? 'g' : 'gi');
            } catch (e) {
                console.warn('Invalid regex query:', e);
                return text;
            }
            return text.replace(regex, match => `<span class="highlight">${match}</span>`);
        }

        function renderSearchSuggestions() {
            const input = document.getElementById('search-input');
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (input.value.trim() && searchHistory.length > 0) {
                suggestionsContainer.innerHTML = searchHistory
                    .filter(query => query.toLowerCase().includes(input.value.toLowerCase()))
                    .map(query => `<div onclick="selectSuggestion('${query}')">${query}</div>`)
                    .join('');
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        function selectSuggestion(query) {
            document.getElementById('search-input').value = query;
            document.getElementById('search-suggestions').style.display = 'none';
            searchMessages();
            triggerHapticFeedback();
        }

        function searchMessages(page = 1) {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                const query = document.getElementById('search-input').value.trim();
                const isExactMatch = document.getElementById('exact-match').checked;
                const isCaseSensitive = document.getElementById('case-sensitive').checked;
                const isWholeWord = document.getElementById('whole-word').checked;
                const resultsContainer = document.getElementById('search-results');
                const statsContainer = document.getElementById('search-stats');
                const loading = document.getElementById('search-loading');
                const progressBar = document.querySelector('.progress-bar div');

                loading.style.display = 'flex';
                progressBar.style.width = '20%';
                resultsContainer.innerHTML = '';
                resultsContainer.style.display = 'none';
                statsContainer.style.display = 'none';
                currentPage = page;

                let filteredMessages = messages;

                if (currentCategory !== '전체') {
                    filteredMessages = filteredMessages.filter(msg => msg.category === currentCategory);
                }

                if (query) {
                    filteredMessages = filteredMessages.filter(msg => {
                        const textToSearch = isCaseSensitive ? msg.text : msg.text.toLowerCase();
                        const searchQuery = isCaseSensitive ? query : query.toLowerCase();
                        if (isWholeWord) {
                            const regex = new RegExp(`\\b${searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, isCaseSensitive ? '' : 'i');
                            return regex.test(textToSearch);
                        } else if (isExactMatch) {
                            return textToSearch.includes(searchQuery);
                        } else {
                            return textToSearch.includes(searchQuery);
                        }
                    });

                    if (!searchHistory.includes(query)) {
                        searchHistory.unshift(query);
                        if (searchHistory.length > 5) searchHistory.pop();
                        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                    }
                } else if (currentCategory === '전체') {
                    filteredMessages = [];
                }

                const startTime = performance.now();
                progressBar.style.width = '60%';
                const startIndex = (page - 1) * resultsPerPage;
                const endIndex = startIndex + resultsPerPage;
                const paginatedMessages = filteredMessages.slice(startIndex, endIndex);

                if (filteredMessages.length === 0 && (query || currentCategory !== '전체')) {
                    resultsContainer.innerHTML = '<p class="no-results" role="alert">검색 결과가 없습니다.</p>';
                    resultsContainer.style.display = 'block';
                } else if (paginatedMessages.length > 0) {
                    resultsContainer.innerHTML = paginatedMessages.map(msg => {
                        const highlightedText = query ? highlightText(msg.text, query, isCaseSensitive, isWholeWord) : msg.text;
                        const queryRegex = query ? new RegExp(isWholeWord ? `\\b${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b` : query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), isCaseSensitive ? 'g' : 'gi') : null;
                        const matchCount = query ? (msg.text.match(queryRegex) || []).length : 0;
                        return `
                            <div class="result-item" role="listitem">
                                <h3><i class="fas fa-book" aria-hidden="true"></i> ${msg.category}</h3>
                                <p>${highlightedText} ${matchCount > 0 && query ? `<span class="match-count" aria-label="일치 횟수 ${matchCount}회">${matchCount}</span>` : ''}</p>
                                <p class="source"><i class="fas fa-book" aria-hidden="true"></i> ${msg.source}</p>
                            </div>
                        `;
                    }).join('');

                    if (filteredMessages.length > endIndex) {
                        resultsContainer.innerHTML += `
                            <button onclick="searchMessages(${page + 1})" class="quiz-button blue" aria-label="다음 페이지" data-tooltip="다음 검색 결과를 확인합니다">다음 페이지</button>
                        `;
                    }
                    resultsContainer.style.display = 'flex';
                }

                const endTime = performance.now();
                if (query || currentCategory !== '전체') {
                    statsContainer.style.display = 'block';
                    statsContainer.innerHTML = `검색 결과: ${filteredMessages.length}개 (현재 페이지: ${page}, 소요 시간: ${(endTime - startTime).toFixed(2)}ms)`;
                }
                loading.style.display = 'none';
                progressBar.style.width = '100%';
                setTimeout(() => progressBar.style.width = '0', 300);
            }, 300);
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('exact-match').checked = false;
            document.getElementById('case-sensitive').checked = false;
            document.getElementById('whole-word').checked = false;
            document.querySelectorAll('.category-container button').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
                if (btn.getAttribute('data-category') === '전체') {
                    btn.classList.add('active');
                    btn.setAttribute('aria-pressed', 'true');
                }
            });
            currentCategory = '전체';
            localStorage.setItem('currentCategory', currentCategory);
            const resultsContainer = document.getElementById('search-results');
            const statsContainer = document.getElementById('search-stats');
            resultsContainer.innerHTML = '';
            resultsContainer.style.display = 'none';
            statsContainer.style.display = 'none';
            document.getElementById('search-suggestions').style.display = 'none';
            searchMessages();
            triggerHapticFeedback();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelector(`#${pageId}`).classList.add('active');

            document.querySelectorAll('.nav-bar button[data-page]').forEach(button => {
                button.classList.remove('active');
                button.setAttribute('aria-current', 'false');
            });
            const activeButton = document.querySelector(`.nav-bar button[data-page="${pageId}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                activeButton.setAttribute('aria-current', 'page');
            }

            if (pageId === 'workbook' && messages.length === 0) {
                loadMessages().then(() => {
                    if (!document.getElementById('search-input').value.trim() && currentCategory === '전체') {
                        document.getElementById('search-results').style.display = 'none';
                        document.getElementById('search-stats').style.display = 'none';
                    } else {
                        searchMessages();
                    }
                });
            } else if (pageId === 'workbook') {
                if (!document.getElementById('search-input').value.trim() && currentCategory === '전체') {
                    document.getElementById('search-results').style.display = 'none';
                    document.getElementById('search-stats').style.display = 'none';
                } else {
                    searchMessages();
                }
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
            triggerHapticFeedback();
        }

        function startQuiz(type) {
            if (type === '원리강론') {
                window.location.href = 'divine.html';
            } else if (type === '성경') {
                window.location.href = 'bible.html';
            }
            triggerHapticFeedback();
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }
            if (localStorage.getItem('highContrast') === 'enabled') {
                document.body.classList.add('high-contrast');
            }
            if (localStorage.getItem('fontSize')) {
                changeFontSize(localStorage.getItem('fontSize'));
            }

            const dismissed = JSON.parse(localStorage.getItem('onboardingDismissed')) || {};
            if (!dismissed['home']) document.getElementById('onboarding-home').style.display = 'flex';
            if (!dismissed['workbook']) document.getElementById('onboarding-workbook').style.display = 'flex';

            document.querySelectorAll('.nav-bar button[data-page]').forEach(button => {
                button.addEventListener('click', () => {
                    showPage(button.getAttribute('data-page'));
                });
                button.addEventListener('touchstart', () => button.classList.add('active'));
                button.addEventListener('touchend', () => button.classList.remove('active'));
            });

            document.querySelectorAll('.category-container button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.category-container button').forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-pressed', 'false');
                    });
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                    currentCategory = button.getAttribute('data-category');
                    localStorage.setItem('currentCategory', currentCategory);
                    searchMessages();
                    triggerHapticFeedback();
                });
                if (button.getAttribute('data-category') === currentCategory) {
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                }
            });

            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', () => {
                searchMessages();
                renderSearchSuggestions();
            });
            searchInput.addEventListener('focus', renderSearchSuggestions);
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('search-suggestions').style.display = 'none';
                }, 200);
            });
            searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    searchMessages();
                    document.getElementById('search-suggestions').style.display = 'none';
                    triggerHapticFeedback();
                }
            });

            document.getElementById('exact-match').addEventListener('change', () => { searchMessages(); triggerHapticFeedback(); });
            document.getElementById('case-sensitive').addEventListener('change', () => { searchMessages(); triggerHapticFeedback(); });
            document.getElementById('whole-word').addEventListener('change', () => { searchMessages(); triggerHapticFeedback(); });

            window.addEventListener('scroll', () => {
                const backToTop = document.querySelector('.back-to-top');
                backToTop.style.display = window.scrollY > 300 ? 'flex' : 'none';
            });

            document.querySelectorAll('button, input[type="checkbox"]').forEach(element => {
                element.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        element.click();
                    }
                });
                element.addEventListener('touchstart', () => element.classList.add('active'));
                element.addEventListener('touchend', () => element.classList.remove('active'));
            });

            document.addEventListener('mousemove', e => {
                if (!magnifierEnabled) return;
                const target = e.target.closest('p, h1, h2, h3, li, .search-stats');
                const overlay = document.getElementById('magnifier-overlay');
                if (target && target.textContent.trim()) {
                    overlay.textContent = target.textContent;
                    overlay.style.display = 'block';
                    overlay.style.left = `${Math.min(e.clientX + 10, window.innerWidth - overlay.offsetWidth - 10)}px`;
                    overlay.style.top = `${Math.min(e.clientY + 10, window.innerHeight - overlay.offsetHeight - 10)}px`;
                } else {
                    overlay.style.display = 'none';
                }
            });

            document.addEventListener('touchstart', e => {
                if (!magnifierEnabled) return;
                const target = e.target.closest('p, h1, h2, h3, li, .search-stats');
                const overlay = document.getElementById('magnifier-overlay');
                if (target && target.textContent.trim()) {
                    overlay.textContent = target.textContent;
                    overlay.style.display = 'block';
                    const touch = e.touches[0];
                    overlay.style.left = `${Math.min(touch.clientX + 10, window.innerWidth - overlay.offsetWidth - 10)}px`;
                    overlay.style.top = `${Math.min(touch.clientY + 10, window.innerHeight - overlay.offsetHeight - 10)}px`;
                    triggerHapticFeedback();
                } else {
                    overlay.style.display = 'none';
                }
            });

            showPage('home');
        });
    </script>
</body>
</html>