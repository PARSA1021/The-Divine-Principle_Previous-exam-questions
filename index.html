<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#e0f2fe">
    <title>세계평화통일가정연합 - 말씀 퀴즈</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Noto Sans KR', 'Arial', sans-serif;
            background: linear-gradient(135deg, #e0f2fe, #f8fafc);
            color: #1e3a8a;
            padding: 1.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-font-smoothing: antialiased;
            -webkit-overflow-scrolling: touch;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1e3a8a, #2d3748);
            color: #e0f2fe;
        }

        body.dark-mode .header,
        body.dark-mode .nav-bar,
        body.dark-mode .search-container,
        body.dark-mode .instructions,
        body.dark-mode .footer,
        body.dark-mode .result-item {
            background: #2d3748;
            color: #e0f2fe;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .search-box input {
            background: #4b5563;
            color: #e0f2fe;
            border-color: #60a5fa;
        }

        body.dark-mode .search-stats {
            background: #4b5563;
            color: #e0f2fe;
        }

        body.dark-mode .no-results {
            background: #7f1d1d;
            color: #f9fafb;
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
            width: 100%;
            max-width: 40rem;
            background: #ffffff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 1rem;
            z-index: 100;
        }

        .nav-bar button {
            background: #1e3a8a;
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        body.dark-mode .nav-bar button {
            background: #60a5fa;
        }

        .nav-bar button.active {
            background: #d4af37;
            transform: scale(1.05);
        }

        .nav-bar button:hover:not(.active) {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .dark-mode-toggle {
            background: #6b7280;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-mode-toggle:hover {
            background: #9ca3af;
        }

        body.dark-mode .dark-mode-toggle {
            background: #9ca3af;
        }

        .page-container {
            width: 100%;
            max-width: 40rem;
            flex: 1;
        }

        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease-out;
        }

        .page.active {
            display: flex;
        }

        .header {
            margin: 1.5rem 0;
            padding: 2rem;
            background: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center;
        }

        .header img {
            width: 6rem;
            height: auto;
            border-radius: 50%;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }

        .header img:hover {
            transform: scale(1.1);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #0d47a1;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .header h1,
        body.dark-mode .header h2,
        body.dark-mode .instructions h2,
        body.dark-mode .search-container h2 {
            color: #bbdefb;
        }

        .header h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: #1e3a8a;
            margin-bottom: 0.75rem;
        }

        .header p {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
        }

        body.dark-mode .header p,
        body.dark-mode .instructions ul,
        body.dark-mode .result-item p,
        body.dark-mode .footer {
            color: #d1d5db;
        }

        .divider {
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
            margin: 1.5rem auto;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
            width: 100%;
        }

        button.quiz-button {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        button.quiz-button.gold {
            background: linear-gradient(135deg, #d4af37, #facc15);
        }

        button.quiz-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button.quiz-button:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e3a8a;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        button.quiz-button:hover::after {
            opacity: 1;
        }

        .search-container {
            width: 100%;
            background: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 1.5rem 0;
        }

        .search-container h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .search-box input {
            flex: 1;
            padding: 0.75rem;
            font-size: 1rem;
            border: 2px solid #1e3a8a;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            border-color: #d4af37;
        }

        .search-box button, .clear-search {
            width: 2.5rem;
            height: 2.5rem;
            background: #1e3a8a;
            color: white;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-search {
            background: #6b7280;
        }

        .search-box button:hover, .clear-search:hover {
            transform: translateY(-2px);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #d4af37;
            border-radius: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        body.dark-mode .search-suggestions {
            background: #4b5563;
            color: #e0f2fe;
        }

        .search-suggestions div {
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .search-suggestions div:hover {
            background: #e0f2fe;
        }

        body.dark-mode .search-suggestions div:hover {
            background: #60a5fa;
        }

        .search-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .search-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #444;
            cursor: pointer;
        }

        body.dark-mode .search-options label {
            color: #d1d5db;
        }

        .search-options input[type="checkbox"] {
            accent-color: #1e3a8a;
            width: 1rem;
            height: 1rem;
        }

        .category-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .category-container button {
            background: #6b7280;
            color: white;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.dark-mode .category-container button {
            background: #4b5563;
        }

        .category-container button.active {
            background: #d4af37;
        }

        .category-container button:hover:not(.active) {
            background: #1e3a8a;
        }

        .search-stats {
            font-size: 0.9rem;
            color: #444;
            background: #f3f4f6;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .result-item {
            background: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        .result-item h3 {
            font-size: 1.2rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 0.5rem;
        }

        .result-item p {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
        }

        .result-item .source {
            font-size: 0.9rem;
            color: #1e3a8a;
            font-style: italic;
        }

        .highlight {
            background: #fef3c7;
            color: #92400e;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }

        .match-count {
            background: #1e3a8a;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            margin-left: 0.5rem;
        }

        .no-results {
            color: #b91c1c;
            font-size: 1rem;
            padding: 1rem;
            background: #fee2e2;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .no-results button {
            background: #1e3a8a;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: #1e3a8a;
            margin: 1rem 0;
        }

        .loading .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #1e3a8a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar div {
            width: 0;
            height: 100%;
            background: #1e3a8a;
            transition: width 0.3s ease;
        }

        .instructions {
            margin: 2rem 0;
            width: 100%;
            background: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: #0d47a1;
            margin-bottom: 1rem;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
            text-align: left;
            font-size: 1rem;
            color: #444;
        }

        .instructions li {
            margin: 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructions i {
            color: #1e3a8a;
            font-size: 1.2rem;
        }

        .footer {
            margin-top: auto;
            padding: 1rem;
            background: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 40rem;
            font-size: 0.9rem;
            color: #444;
        }

        .back-to-top {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: #1e3a8a;
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .back-to-top:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        /* 기존 .result-item 스타일은 유지하거나 필요시 아래 내용으로 일부 대체합니다. */

        /* General .result-item enhancements */
        .result-item {
            background: #ffffff; /* 기존 유지 */
            padding: 1.25rem; /* 패딩 증가로 내부 여백 확보 */
            border-radius: 0.75rem; /* 모서리 둥글게 (기존 0.5rem에서 약간 증가) */
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); /* 부드러운 그림자 효과 */
            border: 1px solid #e7eaf3; /* 밝은 회색 테두리 추가 */
            text-align: left; /* 기존 유지 */
            margin-bottom: 1rem; /* 각 결과 항목 사이의 간격 (필요시 조정) */
        }

        body.dark-mode .result-item {
            background: #2d3748; /* 기존 유지 */
            color: #e0f2fe;    /* 기존 유지 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* 기존 유지 */
            border: 1px solid #374151; /* 다크 모드용 테두리 색상 */
        }

        /* Enhancements for H3 in .result-item */
        .result-item h3 {
            font-size: 1.3rem;   /* 기존 1.2rem 에서 약간 크게 */
            font-weight: 600;    /* 기존 500 에서 더 굵게 (semi-bold) */
            color: #0d47a1;      /* 기존 색상 유지 (가독성 좋음) */
            margin-bottom: 0.75rem; /* 본문과의 간격 증가 (기존 0.5rem 에서 증가) */
            display: flex;         /* 아이콘과 텍스트 정렬을 위해 flex 사용 */
            align-items: center;   /* 수직 중앙 정렬 */
            gap: 0.5rem;           /* 아이콘과 텍스트 사이 간격 */
        }

        body.dark-mode .result-item h3 {
            color: #a5d6fd; /* 다크 모드에서 밝고 선명한 파란색 계열로 변경 */
        }

        /* Enhancements for P (main text) in .result-item */
        /* .source 클래스가 없는 p 태그에만 적용 */
        .result-item p:not(.source) {
            font-size: 1rem;     /* 기존 크기 유지 또는 가독성을 위해 1.05rem으로 약간 확대 가능 */
            line-height: 1.65;   /* 줄 간격 증가로 가독성 향상 (기존 1.6에서 증가) */
            color: #333333;     /* 기존 #444 보다 약간 더 진한 회색으로 변경 (흰 배경에서 대비 향상) */
            margin-bottom: 0.75rem; /* 출처 정보와의 간격 */
        }

        body.dark-mode .result-item p:not(.source) {
            color: #cdd5e0; /* 다크 모드에서 기존 #d1d5db 보다 약간 조정된 밝은 회색 */
        }

        /* Enhancements for P.source in .result-item */
        .result-item p.source {
            font-size: 0.9rem;   /* 기존 크기 유지 (보조 정보에 적합) */
            color: #5a67d8;      /* 기존 #1e3a8a 보다 구별되면서도 너무 튀지 않는 색상 (예: 인디고 계열) */
            font-style: italic;  /* 기존 스타일 유지 */
            margin-top: 0.5rem;  /* 본문과의 간격 확보 (p:not(.source)의 margin-bottom으로도 조절 가능) */
            display: flex;       /* 아이콘과 텍스트 정렬을 위해 flex 사용 */
            align-items: center; /* 수직 중앙 정렬 */
            gap: 0.4rem;         /* 아이콘과 텍스트 사이 간격 */
        }

        body.dark-mode .result-item p.source {
            color: #8fa3bf; /* 다크 모드에서 부드럽고 차분한 색상으로 변경 */
        }

        /* 아이콘 정렬 개선 (이미 flex로 처리했지만, 만약을 위해) */
        .result-item h3 i,
        .result-item p.source i {
            line-height: 1; /* Font Awesome 아이콘의 수직 정렬에 도움 */
            font-size: inherit; /* 부모 요소의 글꼴 크기를 따르도록 하여 일관성 유지 */
        }

        /* 하이라이트 및 매치 카운트 스타일은 기존 스타일 유지 또는 필요에 따라 조정 */
        .highlight { /* 기존 스타일 유지 */
            background: #fef3c7;
            color: #92400e;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }

        .match-count { /* 기존 스타일 유지 */
            background: #1e3a8a;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            margin-left: 0.5rem;
            font-size: 0.8em; /* 본문 텍스트보다 약간 작게 */
            vertical-align: middle; /* 텍스트 옆에 있을 때 수직 정렬 개선 */
        }

        body.dark-mode .highlight {
            background: #4a3a14; /* 다크모드용 하이라이트 배경 */
            color: #fde68a;    /* 다크모드용 하이라이트 텍스트 */
        }

        body.dark-mode .match-count {
            background: #60a5fa; /* 다크모드용 매치 카운트 배경 */
            color: #1e3a8a;    /* 다크모드용 매치 카운트 텍스트 */
        }

        @media (min-width: 768px) {
            .nav-bar {
                padding: 1.25rem;
            }
            .nav-bar button {
                font-size: 1.2rem;
                padding: 0.75rem 2rem;
            }
            .header h1 {
                font-size: 2.5rem;
            }
            .header h2 {
                font-size: 1.75rem;
            }
            .header p {
                font-size: 1.1rem;
            }
            .button-container {
                flex-direction: row;
                justify-content: center;
            }
            button.quiz-button {
                width: 12rem;
            }
            .search-container h2 {
                font-size: 1.75rem;
            }
            .search-box input {
                font-size: 1.1rem;
            }
            .search-box button, .clear-search {
                width: 3rem;
                height: 3rem;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
            body {
                padding: 1rem;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header h2 {
                font-size: 1.4rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .header img {
                width: 5rem;
            }
            button.quiz-button {
                font-size: 1.1rem;
            }
            .nav-bar button {
                font-size: 1rem;
                padding: 0.5rem 1rem;
            }
            .back-to-top {
                display: flex;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <nav class="nav-bar" aria-label="메인 내비게이션">
        <button data-page="home" class="active" aria-current="page"><i class="fas fa-home"></i> 홈</button>
        <button data-page="workbook"><i class="fas fa-book-open"></i> 말씀 DB</button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="다크 모드 전환"><i class="fas fa-moon"></i></button>
    </nav>

    <main class="page-container">
        <section class="page active" id="home" role="region" aria-labelledby="home-heading">
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="100" height="100">
                </div>
                <h1 id="home-heading">말씀 퀴즈</h1>
                <h2>영감과 지혜의 여정</h2>
                <p>세계평화통일가정연합의 말씀을 통해 영적 성장을 경험하세요.</p>
                <p>원리강론과 성경 퀴즈로 지혜를 쌓고, 깊이 있는 검색으로 말씀을 탐구하세요.</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="button-container">
                <button class="quiz-button blue" onclick="startQuiz('원리강론')" aria-label="원리강론 퀴즈 시작" data-tooltip="원리강론을 기반으로 한 퀴즈로 통일원리를 탐구하세요">
                    <i class="fas fa-school"></i> 원리강론 퀴즈
                </button>
                <button class="quiz-button gold" onclick="startQuiz('성경')" aria-label="성경 퀴즈 시작" data-tooltip="성경 말씀을 통해 신앙을 깊이 이해하세요">
                    <i class="fas fa-cross"></i> 성경 퀴즈
                </button>
            </div>
            <div class="divider" aria-hidden="true"></div>
            <section class="instructions" role="complementary" aria-labelledby="instructions-heading">
                <h2 id="instructions-heading"><i class="fas fa-info-circle"></i> 사용 방법</h2>
                <ul>
                    <li><i class="fas fa-hand-pointer"></i> <strong>퀴즈 시작:</strong> 원리강론 또는 성경 퀴즈 버튼을 클릭하세요.</li>
                    <li><i class="fas fa-question-circle"></i> <strong>답변 선택:</strong> 빈칸에 맞는 답을 선택하세요.</li>
                    <li><i class="fas fa-check-circle"></i> <strong>정답 확인:</strong> 답변 후 "정답 확인"을 클릭하세요.</li>
                    <li><i class="fas fa-arrow-right"></i> <strong>다음 문제:</strong> 정답 시 다음 문제로 이동합니다.</li>
                    <li><i class="fas fa-redo"></i> <strong>다시 시작:</strong> 퀴즈 완료 후 "다시 시작"을 클릭하세요.</li>
                </ul>
            </section>
        </section>

        <section class="page" id="workbook" role="region" aria-labelledby="workbook-heading">
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="100" height="100">
                </div>
                <h1 id="workbook-heading"><i class="fas fa-book-open"></i> 말씀 데이터베이스</h1>
                <h2>말씀의 보물창고</h2>
                <p>천성경, 통일원리, 성경 등 다양한 말씀을 탐구하세요.</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="search-container">
                <h2><i class="fas fa-search"></i> 말씀 검색</h2>
                <div class="search-box">
                    <label for="search-input" class="sr-only">검색어 입력</label>
                    <input type="text" id="search-input" placeholder="검색어를 입력하세요" aria-label="검색어 입력 필드" autocomplete="off">
                    <div class="search-suggestions" id="search-suggestions"></div>
                    <button onclick="searchMessages()" title="검색 실행" aria-label="검색"><i class="fas fa-search"></i></button>
                    <button class="clear-search" onclick="clearSearch()" title="검색 초기화" aria-label="검색 초기화"><i class="fas fa-times"></i></button>
                </div>
                <div class="search-options" role="group" aria-label="검색 옵션">
                    <label>
                        <input type="checkbox" id="exact-match">
                        <i class="fas fa-quote-left"></i> 정확한 단어
                    </label>
                    <label>
                        <input type="checkbox" id="case-sensitive">
                        <i class="fas fa-font"></i> 대소문자 구분
                    </label>
                    <label>
                        <input type="checkbox" id="whole-word">
                        <i class="fas fa-signature"></i> 전체 단어
                    </label>
                </div>
                <div class="category-container" role="group" aria-label="카테고리 필터">
                    <button class="active" data-category="전체" aria-pressed="true">전체</button>
                    <button data-category="천성경" aria-pressed="false">천성경</button>
                    <button data-category="성경" aria-pressed="false">성경</button>
                    <button data-category="평화메시지" aria-pressed="false">평화메시지</button>
                    <button data-category="기타" aria-pressed="false">기타</button>
                    <button data-category="참부모님 말씀" aria-pressed="false">참부모님 말씀</button>
                </div>
                <div id="search-stats" class="search-stats" style="display: none;" role="status" aria-live="polite"></div>
            </div>
            <div id="search-loading" class="loading" style="display: none;" aria-live="assertive" aria-atomic="true">
                <div class="spinner" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="검색 중"></div>
                검색 중...
                <div class="progress-bar"><div></div></div>
            </div>
            <div id="search-results" class="search-results" style="display: none;" role="list"></div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <p>© 2025 세계평화통일가정연합. All rights reserved.</p>
    </footer>

    <button class="back-to-top" onclick="scrollToTop()" aria-label="페이지 맨 위로 이동"><i class="fas fa-arrow-up"></i></button>

    <script>
        let messages = [];
        let currentCategory = localStorage.getItem('currentCategory') || '전체';
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
        let debounceTimeout;
        let currentPage = 1;
        const resultsPerPage = 10;

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadMessages() {
            const loading = document.getElementById('search-loading');
            const progressBar = document.querySelector('.progress-bar div');
            loading.style.display = 'flex';
            progressBar.style.width = '20%';
            try {
                const response = await fetch('messages.json');
                progressBar.style.width = '60%';
                if (!response.ok) throw new Error('Failed to load messages.json');
                messages = await response.json();
                progressBar.style.width = '100%';
                messages = messages.map(msg => {
                    if (!msg.category) {
                        if (msg.source.includes('천성경')) msg.category = '천성경';
                        else if (msg.source.includes('성경')) msg.category = '성경';
                        else if (msg.source.includes('평화메시지')) msg.category = '평화메시지';
                        else if (msg.source.includes('참부모님 말씀')) msg.category = '참부모님 말씀';
                        else msg.category = '기타';
                    }
                    return msg;
                });
            } catch (error) {
                console.error('Error loading messages:', error);
                document.getElementById('search-results').innerHTML = `
                    <p class="no-results" role="alert">
                        메시지를 로드하는 데 실패했습니다.
                        <button onclick="loadMessages()" aria-label="다시 시도">다시 시도</button>
                    </p>`;
            } finally {
                setTimeout(() => {
                    loading.style.display = 'none';
                    progressBar.style.width = '0';
                }, 300);
            }
        }

        function highlightText(text, query, isCaseSensitive, isWholeWord) {
            if (!query) return text;
            let regex;
            try {
                const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const pattern = isWholeWord ? `\\b${escapedQuery}\\b` : escapedQuery;
                regex = new RegExp(pattern, isCaseSensitive ? 'g' : 'gi');
            } catch (e) {
                console.warn('Invalid regex query:', e);
                return text;
            }
            return text.replace(regex, match => `<span class="highlight">${match}</span>`);
        }

        function renderSearchSuggestions() {
            const input = document.getElementById('search-input');
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (input.value.trim() && searchHistory.length > 0) {
                suggestionsContainer.innerHTML = searchHistory
                    .filter(query => query.toLowerCase().includes(input.value.toLowerCase()))
                    .map(query => `<div onclick="selectSuggestion('${query}')">${query}</div>`)
                    .join('');
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        function selectSuggestion(query) {
            document.getElementById('search-input').value = query;
            document.getElementById('search-suggestions').style.display = 'none';
            searchMessages();
        }

        function searchMessages(page = 1) {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                const query = document.getElementById('search-input').value.trim();
                const isExactMatch = document.getElementById('exact-match').checked;
                const isCaseSensitive = document.getElementById('case-sensitive').checked;
                const isWholeWord = document.getElementById('whole-word').checked;
                const resultsContainer = document.getElementById('search-results');
                const statsContainer = document.getElementById('search-stats');
                const loading = document.getElementById('search-loading');
                const progressBar = document.querySelector('.progress-bar div');

                loading.style.display = 'flex';
                progressBar.style.width = '20%';
                resultsContainer.innerHTML = '';
                resultsContainer.style.display = 'none';
                statsContainer.style.display = 'none';
                currentPage = page;

                let filteredMessages = messages;

                if (currentCategory !== '전체') {
                    filteredMessages = filteredMessages.filter(msg => msg.category === currentCategory);
                }

                if (query) {
                    filteredMessages = filteredMessages.filter(msg => {
                        const textToSearch = isCaseSensitive ? msg.text : msg.text.toLowerCase();
                        const searchQuery = isCaseSensitive ? query : query.toLowerCase();
                        if (isWholeWord) {
                            const regex = new RegExp(`\\b${searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, isCaseSensitive ? '' : 'i');
                            return regex.test(textToSearch);
                        } else if (isExactMatch) {
                            return textToSearch.includes(searchQuery);
                        } else {
                            return textToSearch.includes(searchQuery);
                        }
                    });

                    if (!searchHistory.includes(query)) {
                        searchHistory.unshift(query);
                        if (searchHistory.length > 5) searchHistory.pop();
                        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                    }
                } else if (currentCategory === '전체') {
                    filteredMessages = [];
                }

                const startTime = performance.now();
                progressBar.style.width = '60%';
                const startIndex = (page - 1) * resultsPerPage;
                const endIndex = startIndex + resultsPerPage;
                const paginatedMessages = filteredMessages.slice(startIndex, endIndex);

                if (filteredMessages.length === 0 && (query || currentCategory !== '전체')) {
                    resultsContainer.innerHTML = '<p class="no-results" role="alert">검색 결과가 없습니다.</p>';
                    resultsContainer.style.display = 'block';
                } else if (paginatedMessages.length > 0) {
                    resultsContainer.innerHTML = paginatedMessages.map(msg => {
                        const highlightedText = query ? highlightText(msg.text, query, isCaseSensitive, isWholeWord) : msg.text;
                        const queryRegex = query ? new RegExp(isWholeWord ? `\\b${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b` : query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), isCaseSensitive ? 'g' : 'gi') : null;
                        const matchCount = query ? (msg.text.match(queryRegex) || []).length : 0;
                        return `
                            <div class="result-item" role="listitem">
                                <h3><i class="fas fa-book" aria-hidden="true"></i> ${msg.category}</h3>
                                <p>${highlightedText} ${matchCount > 0 && query ? `<span class="match-count" aria-label="일치 횟수 ${matchCount}회">${matchCount}</span>` : ''}</p>
                                <p class="source"><i class="fas fa-book" aria-hidden="true"></i> ${msg.source}</p>
                            </div>
                        `;
                    }).join('');

                    if (filteredMessages.length > endIndex) {
                        resultsContainer.innerHTML += `
                            <button onclick="searchMessages(${page + 1})" class="quiz-button blue" aria-label="다음 페이지">다음 페이지</button>
                        `;
                    }
                    resultsContainer.style.display = 'flex';
                }

                const endTime = performance.now();
                if (query || currentCategory !== '전체') {
                    statsContainer.style.display = 'block';
                    statsContainer.innerHTML = `검색 결과: ${filteredMessages.length}개 (현재 페이지: ${page}, 소요 시간: ${(endTime - startTime).toFixed(2)}ms)`;
                }
                loading.style.display = 'none';
                progressBar.style.width = '100%';
                setTimeout(() => progressBar.style.width = '0', 300);
            }, 300);
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('exact-match').checked = false;
            document.getElementById('case-sensitive').checked = false;
            document.getElementById('whole-word').checked = false;
            document.querySelectorAll('.category-container button').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
                if (btn.getAttribute('data-category') === '전체') {
                    btn.classList.add('active');
                    btn.setAttribute('aria-pressed', 'true');
                }
            });
            currentCategory = '전체';
            localStorage.setItem('currentCategory', currentCategory);
            const resultsContainer = document.getElementById('search-results');
            const statsContainer = document.getElementById('search-stats');
            resultsContainer.innerHTML = '';
            resultsContainer.style.display = 'none';
            statsContainer.style.display = 'none';
            document.getElementById('search-suggestions').style.display = 'none';
            searchMessages();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelector(`#${pageId}`).classList.add('active');

            document.querySelectorAll('.nav-bar button').forEach(button => {
                button.classList.remove('active');
                button.setAttribute('aria-current', 'false');
            });
            const activeButton = document.querySelector(`.nav-bar button[data-page="${pageId}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                activeButton.setAttribute('aria-current', 'page');
            }

            if (pageId === 'workbook' && messages.length === 0) {
                loadMessages().then(() => {
                    if (!document.getElementById('search-input').value.trim() && currentCategory === '전체') {
                        document.getElementById('search-results').style.display = 'none';
                        document.getElementById('search-stats').style.display = 'none';
                    } else {
                        searchMessages();
                    }
                });
            } else if (pageId === 'workbook') {
                if (!document.getElementById('search-input').value.trim() && currentCategory === '전체') {
                    document.getElementById('search-results').style.display = 'none';
                    document.getElementById('search-stats').style.display = 'none';
                } else {
                    searchMessages();
                }
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function startQuiz(type) {
            if (type === '원리강론') {
                window.location.href = 'divine.html';
            } else if (type === '성경') {
                window.location.href = 'bible.html';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }

            document.querySelectorAll('.nav-bar button[data-page]').forEach(button => {
                button.addEventListener('click', () => {
                    showPage(button.getAttribute('data-page'));
                });
            });

            document.querySelectorAll('.category-container button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.category-container button').forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-pressed', 'false');
                    });
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                    currentCategory = button.getAttribute('data-category');
                    localStorage.setItem('currentCategory', currentCategory);
                    searchMessages();
                });
                if (button.getAttribute('data-category') === currentCategory) {
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                }
            });

            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', () => {
                searchMessages();
                renderSearchSuggestions();
            });
            searchInput.addEventListener('focus', renderSearchSuggestions);
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('search-suggestions').style.display = 'none';
                }, 200);
            });
            searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    searchMessages();
                    document.getElementById('search-suggestions').style.display = 'none';
                }
            });

            document.getElementById('exact-match').addEventListener('change', searchMessages);
            document.getElementById('case-sensitive').addEventListener('change', searchMessages);
            document.getElementById('whole-word').addEventListener('change', searchMessages);

            window.addEventListener('scroll', () => {
                const backToTop = document.querySelector('.back-to-top');
                backToTop.style.display = window.scrollY > 300 ? 'flex' : 'none';
            });

            document.querySelectorAll('button, input[type="checkbox"]').forEach(element => {
                element.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        element.click();
                    }
                });
            });

            showPage('home');
        });
    </script>
</body>
</html> 