<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#dbeafe">
    <title>세계평화통일가정연합 - 원리강론 퀴즈</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 기본 설정 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Noto Sans KR', 'Arial', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #dbeafe, #f8fafc);
            padding: 1.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 1s ease-in;
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            color: #333;
        }

        /* 내비게이션 바 */
        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
            width: 100%;
            max-width: 38rem;
            flex-wrap: wrap;
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 1.5rem;
            z-index: 10;
        }

        .nav-bar button {
            background: linear-gradient(135deg, #1e3a8a, #60a5fa);
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
            height: 3.5rem;
            width: 8rem;
            border-radius: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.625rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            -webkit-tap-highlight-color: transparent;
        }

        .nav-bar button.active {
            background: linear-gradient(135deg, #d4af37, #facc15);
            box-shadow: 0 0 0.625rem rgba(212, 175, 55, 0.5);
            transform: translateY(-0.1875rem);
        }

        .nav-bar button:hover:not(.active) {
            transform: translateY(-0.1875rem) rotate(2deg);
            box-shadow: 0 0.375rem 0.875rem rgba(0, 0, 0, 0.2);
        }

        .nav-bar button:active {
            transform: scale(0.97);
            box-shadow: 0 0.125rem 0.375rem rgba(0, 0, 0, 0.2);
        }

        /* 페이지 컨테이너 */
        .page-container {
            width: 100%;
            max-width: 42rem;
            flex: 1;
        }

        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.5s ease-out;
        }

        .page.active {
            display: flex;
        }

        /* 헤더 */
        .header {
            margin: 1.5rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            border-radius: 1rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 15rem;
            height: 15rem;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.2), transparent);
            transform: translate(-50%, -50%);
            z-index: 0;
            border-radius: 50%;
        }

        .header .logo-container {
            margin-bottom: 1.5rem;
            z-index: 1;
            position: relative;
        }

        .header img {
            width: 7.5rem;
            height: auto;
            border-radius: 50%;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
            -webkit-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
        }

        .header img:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .header h1 {
            color: #002366;
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0.0625rem 0.0625rem 0.25rem rgba(0, 0, 0, 0.1);
            z-index: 1;
            position: relative;
        }

        .header h2 {
            color: #1e3a8a;
            font-size: 1.8rem;
            margin: 0.875rem 0;
            font-weight: 600;
            z-index: 1;
            position: relative;
        }

        .header p {
            color: #444;
            font-size: 1.15rem;
            margin: 0.75rem 0;
            line-height: 1.6;
            z-index: 1;
            position: relative;
        }

        /* 구분선 */
        .divider {
            width: 80%;
            height: 0.125rem;
            background: linear-gradient(90deg, transparent, #d4ad37f7, transparent);
            margin: 1.5rem 0;
        }

        /* 버튼 컨테이너 */
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin: 2rem 0;
            width: 100%;
            touch-action: manipulation;
        }

        button.quiz-button {
            width: 100%;
            height: 4.5rem;
            font-size: 1.4rem;
            border-radius: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.2);
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow: hidden;
            color: white;
        }

        button.quiz-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
            z-index: 0;
        }

        button.quiz-button:hover::after {
            width: 20rem;
            height: 20rem;
        }

        button.blue {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
        }

        button.gold {
            background: linear-gradient(135deg, #d4af37, #facc15);
        }

        button.quiz-button:hover {
            transform: translateY(-0.1875rem);
            box-shadow: 0 0.375rem 1rem rgba(0, 0, 0, 0.25);
        }

        button.quiz-button:active {
            transform: scale(0.97);
            box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.2);
        }

        /* 검색 컨테이너 */
        .search-container {
            width: 100%;
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            margin: 1.5rem 0;
        }

        .search-container h2 {
            color: #002366;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            margin-bottom: 1.75rem;
        }

        .search-box input {
            flex: 1;
            padding: 1rem;
            font-size: 1.2rem;
            border: 0.15rem solid #1e3a8a;
            border-radius: 0.75rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #f8fafc;
            color: #333;
            height: 3.5rem;
        }

        .search-box input::placeholder {
            color: #777;
            font-style: italic;
        }

        .search-box input:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0.625rem rgba(212, 175, 55, 0.3);
        }

        .search-box button {
            width: 3.5rem;
            height: 3.5rem;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            font-size: 1.4rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.15);
            -webkit-tap-highlight-color: transparent;
        }

        .search-box button:hover {
            transform: translateY(-0.125rem);
            box-shadow: 0 0.375rem 0.75rem rgba(0, 0, 0, 0.2);
        }

        .clear-search {
            width: 3.5rem;
            height: 3.5rem;
            background: linear-gradient(135deg, #6b7280, #9ca3af);
            color: white;
            font-size: 1.2rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.15);
            -webkit-tap-highlight-color: transparent;
        }

        .clear-search:hover {
            transform: translateY(-0.125rem);
            box-shadow: 0 0.375rem 0.75rem rgba(0, 0, 0, 0.2);
        }

        .search-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .search-options label {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            color: #444;
            font-size: 1.1rem;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .search-options label i {
            color: #1e3a8a;
            font-size: 1.2rem;
        }

        .search-options input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: #1e3a8a;
            cursor: pointer;
            transform: scale(1.1);
        }

        .category-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.875rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .category-container button {
            background: linear-gradient(135deg, #4b5563, #6b7280);
            color: white;
            font-size: 1.05rem;
            font-weight: 500;
            height: 3rem;
            min-width: 7.5rem;
            padding: 0 0.75rem;
            border-radius: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.15);
            -webkit-tap-highlight-color: transparent;
        }

        .category-container button.active {
            background: linear-gradient(135deg, #d4af37, #facc15);
            transform: translateY(-0.125rem);
            box-shadow: 0 0.375rem 0.75rem rgba(0, 0, 0, 0.2);
        }

        .category-container button:hover:not(.active) {
            background: linear-gradient(135deg, #1e3a8a, #60a5fa);
            transform: translateY(-0.125rem);
        }

        .category-container button:active {
            transform: scale(0.95);
        }

        /* 검색 통계 */
        .search-stats {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: 0.625rem;
            color: #374151;
            font-size: 1rem;
            text-align: left;
            animation: slideDown 0.4s ease-out;
        }

        /* 검색 결과 */
        .search-results {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .result-item {
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            padding: 1.5rem;
            border-radius: 0.875rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            text-align: left;
            animation: slideUp 0.5s ease-out;
            border-left: 0.3125rem solid #1e3a8a;
        }

        .result-item.highlighted {
            border-left-color: #d4af37;
            box-shadow: 0 0.25rem 0.75rem rgba(212, 175, 55, 0.2);
        }

        .result-item h3 {
            color: #002366;
            font-size: 1.4rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .result-item p {
            color: #444;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .result-item .source {
            color: #1e3a8a;
            font-size: 0.95rem;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .highlight {
            background: linear-gradient(120deg, #fef3c7, #fbbf24);
            padding: 0.1875rem 0.375rem;
            border-radius: 0.25rem;
            font-weight: 600;
            color: #92400e;
            box-shadow: 0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.1);
        }

        .match-count {
            background: #1e3a8a;
            color: white;
            font-size: 0.9rem;
            padding: 0.1875rem 0.5rem;
            border-radius: 0.75rem;
            margin-left: 0.75rem;
            flex-shrink: 0;
        }

        .no-results {
            color: #b91c1c;
            font-size: 1.2rem;
            text-align: center;
            margin: 1.5rem 0;
            padding: 3rem;
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-radius: 0.875rem;
            border: 0.15rem dashed #fca5a5;
        }

        /* 로딩 스피너 */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            color: #1e3a8a;
            font-size: 1.2rem;
            margin: 1.5rem 0;
            min-height: 4rem;
        }

        .loading .spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 0.1875rem solid #e5e7eb;
            border-top: 0.1875rem solid #1e3a8a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* 사용 방법 */
        .instructions {
            margin: 2rem 0;
            width: 100%;
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.8s ease-out;
        }

        .instructions h2 {
            color: #002366;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
            text-align: left;
            color: #444;
            font-size: 1.15rem;
        }

        .instructions li {
            margin: 1.125rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
            line-height: 1.7;
            animation: slideInLeft 0.6s ease-out forwards;
            opacity: 0;
        }
        .instructions li:nth-child(1) { animation-delay: 0.1s; }
        .instructions li:nth-child(2) { animation-delay: 0.2s; }
        .instructions li:nth-child(3) { animation-delay: 0.3s; }
        .instructions li:nth-child(4) { animation-delay: 0.4s; }
        .instructions li:nth-child(5) { animation-delay: 0.5s; }
        .instructions li:nth-child(6) { animation-delay: 0.6s; }

        .instructions i {
            color: #1e3a8a;
            font-size: 1.3rem;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }

        /* 푸터 */
        .footer {
            margin-top: auto;
            padding: 1.5rem;
            color: #444;
            font-size: 1.05rem;
            background: linear-gradient(135deg, #ffffff, #fff9e6);
            border-radius: 0.875rem;
            box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 38rem;
            text-align: center;
        }

        /* 미디어 쿼리 - 태블릿 및 데스크톱 */
        @media (min-width: 768px) {
            body {
                padding: 2rem;
            }

            .nav-bar {
                top: 2rem;
                padding: 1.25rem;
                gap: 1.25rem;
            }

            .nav-bar button {
                width: 9.5rem;
                font-size: 1.2rem;
                height: 3.8rem;
            }

            .button-container {
                flex-direction: row;
                gap: 1.875rem;
            }

            button.quiz-button {
                width: 15.625rem;
                height: 4.8rem;
                font-size: 1.6rem;
            }

            .header h1 {
                font-size: 2.8rem;
            }

            .header h2 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1.3rem;
            }

            .instructions h2, .search-container h2 {
                font-size: 2rem;
            }

            .instructions ul {
                font-size: 1.2rem;
            }

            .category-container button {
                width: 8.5rem;
                height: 3.25rem;
                font-size: 1.1rem;
            }

            .search-box input {
                padding: 1.125rem;
                font-size: 1.3rem;
            }

            .search-box button, .clear-search {
                width: 3.8rem;
                height: 3.8rem;
                font-size: 1.5rem;
            }

            .result-item {
                padding: 1.875rem;
            }

            .result-item h3 {
                font-size: 1.55rem;
            }

            .result-item p {
                font-size: 1.2rem;
            }

            .footer {
                padding: 1.875rem;
                font-size: 1.1rem;
            }
        }

        /* 미디어 쿼리 - 작은 모바일 기기 */
        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
            body {
                padding: 1rem;
            }
            .header h1 {
                font-size: 2rem;
            }

            .header h2 {
                font-size: 1.6rem;
            }

            .header p {
                font-size: 1rem;
            }

            .header img {
                width: 6rem;
            }

            button.quiz-button {
                height: 4rem;
                font-size: 1.3rem;
            }

            .nav-bar button {
                width: 7rem;
                font-size: 1rem;
                height: 3.2rem;
            }

            .category-container button {
                width: 6.5rem;
                font-size: 0.95rem;
                height: 2.8rem;
            }

            .search-container h2 {
                font-size: 1.6rem;
            }

            .search-box input {
                font-size: 1.05rem;
                padding: 0.8rem;
                height: 3.2rem;
            }

            .search-box button, .clear-search {
                width: 3.2rem;
                height: 3.2rem;
                font-size: 1.3rem;
            }

            .result-item {
                padding: 1.25rem;
            }

            .result-item h3 {
                font-size: 1.3rem;
            }

            .result-item p {
                font-size: 1rem;
            }

            .instructions ul {
                font-size: 1.05rem;
            }

            .instructions li {
                margin: 0.8rem 0;
                gap: 0.6rem;
            }

            .footer {
                padding: 1.25rem;
                font-size: 1.1rem;
            }
        }

        /* 애니메이션 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-1.25rem); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(1.25rem); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* 홈 섹션 전용 스타일 */
        #home .header {
            background: linear-gradient(135deg, #e0f2fe, #d4f0ff);
            border: 0.125rem solid #a7d9f7;
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15);
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
        }

        #home .header::before {
            background: radial-gradient(circle, rgba(175, 212, 255, 0.3), transparent 70%);
            width: 20rem;
            height: 20rem;
            animation: pulse 4s infinite ease-in-out;
        }

        #home .header img {
            width: 9rem;
            height: 9rem;
            border: 0.25rem solid #ffffff;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.25);
            transition: transform 0.5s ease-in-out, box-shadow 0.5s ease-in-out;
        }

        #home .header img:hover {
            transform: scale(1.15) rotate(7deg);
            box-shadow: 0 0.8rem 1.5rem rgba(0, 0, 0, 0.35);
        }

        #home .header h1 {
            color: #0d47a1;
            font-size: 3rem;
            margin-top: 1.5rem;
            text-shadow: 0.1rem 0.1rem 0.3rem rgba(0, 0, 0, 0.15);
        }

        #home .header h2 {
            color: #1565c0;
            font-size: 2.2rem;
            margin: 1rem 0;
        }

        #home .header p {
            color: #333;
            font-size: 1.25rem;
            max-width: 90%;
            margin: 0.8rem auto;
        }

        #home .button-container {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            margin: 2.5rem 0;
        }

        #home button.quiz-button {
            height: 5rem;
            min-width: 16rem;
            font-size: 1.6rem;
            border-radius: 1.25rem;
            box-shadow: 0 0.6rem 1.5rem rgba(0, 0, 0, 0.2);
            letter-spacing: 0.05rem;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        #home button.quiz-button.blue {
            background: linear-gradient(135deg, #1976d2, #2196f3);
        }

        #home button.quiz-button.gold {
            background: linear-gradient(135deg, #ffb300, #ffca28);
        }

        #home button.quiz-button:hover {
            transform: translateY(-0.35rem) scale(1.02);
            box-shadow: 0 0.8rem 2rem rgba(0, 0, 0, 0.3);
        }

        #home button.quiz-button::after {
            background: rgba(255, 255, 255, 0.4);
        }

        /* 반응형 디자인 (홈 섹션) */
        @media (max-width: 768px) {
            #home .header {
                padding: 2rem 1.5rem;
            }
            #home .header h1 {
                font-size: 2.2rem;
            }
            #home .header h2 {
                font-size: 1.8rem;
            }
            #home .header p {
                font-size: 1.1rem;
            }
            #home .header img {
                width: 7rem;
                height: 7rem;
            }
            #home .button-container {
                flex-direction: column;
                gap: 1.5rem;
            }
            #home button.quiz-button {
                height: 4.5rem;
                font-size: 1.4rem;
                min-width: unset;
                width: 100%;
            }
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.7; }
            100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
        }
    </style>
</head>
<body>
    <nav class="nav-bar" aria-label="메인 내비게이션">
        <button data-page="home" class="active" aria-current="page"><i class="fas fa-home"></i> 홈</button>
        <button data-page="workbook"><i class="fas fa-book-open"></i> 말씀 DB</button>
    </nav>

    <main class="page-container">
        <section class="page active" id="home" role="region" aria-labelledby="home-heading">
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="100" height="100">
                </div>
                <h1 id="home-heading"><i class="fas fa-book-reader"></i> 원리강론 퀴즈</h1>
                <h2><i class="fas fa-lightbulb"></i> 배움을 즐기는 새로운 방법</h2>
                <p>세계평화통일가정연합 교육 플랫폼입니다. 심오한 원리와 성경을 통해 지혜를 넓히고, 참부모님의 말씀을 깊이 이해하는 여정에 함께하세요.</p>
                <p>재미있는 퀴즈와 심도 있는 검색 기능으로 영적 성장을 경험하세요!</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="button-container">
                <button class="quiz-button blue" onclick="startQuiz('원리강론')" aria-label="원리강론 문제 시작">
                    <i class="fas fa-school"></i> 원리강론 문제
                </button>
                <button class="quiz-button gold" onclick="startQuiz('성경')" aria-label="성경 문제 시작">
                    <i class="fas fa-cross"></i> 성경 문제
                </button>
            </div>
            <div class="divider" aria-hidden="true"></div>
            <section class="instructions" role="complementary" aria-labelledby="instructions-heading">
                <h2 id="instructions-heading"><i class="fas fa-info-circle"></i> 사용 방법</h2>
                <ul>
                    <li><i class="fas fa-hand-pointer"></i> <strong>퀴즈 시작:</strong> 원리강론 또는 성경 퀴즈 버튼을 클릭하세요.</li>
                    <li><i class="fas fa-question-circle"></i> <strong>답변 선택:</strong> 빈칸에 맞는 답을 선택지에서 클릭.</li>
                    <li><i class="fas fa-check-circle"></i> <strong>정답 확인:</strong> 빈칸 채운 후 "정답 확인" 클릭.</li>
                    <li><i class="fas fa-arrow-right"></i> <strong>다음 문제:</strong> 정답 시 "다음 문제"로 이동.</li>
                    <li><i class="fas fa-redo"></i> <strong>다시 시작:</strong> 퀴즈 완료 후 "다시 시작" 클릭.</li>
                    <li><i class="fas fa-lightbulb"></i> <strong>팁:</strong> 잘못 선택 시 빈칸/선택지 다시 클릭.</li>
                </ul>
            </section>
        </section>

        <section class="page" id="workbook" role="region" aria-labelledby="workbook-heading">
            <header class="header">
                <div class="logo-container">
                    <img src="assets/images/FFWPU.png" alt="세계평화통일가정연합 로고" width="100" height="100">
                </div>
                <h1 id="workbook-heading"><i class="fas fa-book-open"></i> 말씀 DB</h1>
                <h2>말씀 저장 창고</h2>
                <p>천성경 등 앞으로 많은 말씀들을 준비하겠습니다</p>
                <p>세계평화통일가정연합의 말씀을 통해 축복을 준비하세요.</p>
            </header>
            <div class="divider" aria-hidden="true"></div>
            <div class="search-container">
                <h2><i class="fas fa-search"></i> 고급 말씀 검색</h2>
                <div class="search-box">
                    <label for="search-input" class="sr-only">검색어 입력</label>
                    <input type="text" id="search-input" placeholder="검색어를 입력하세요 (예: 사랑, 축복, 가정)" aria-label="검색어 입력 필드">
                    <button onclick="searchMessages()" title="검색 실행" aria-label="검색"><i class="fas fa-search"></i></button>
                    <button class="clear-search" onclick="clearSearch()" title="검색 초기화" aria-label="검색 초기화"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="search-options" role="group" aria-label="검색 옵션">
                    <label>
                        <input type="checkbox" id="exact-match" onchange="searchMessages()">
                        <i class="fas fa-quote-left"></i> 정확한 단어 일치
                    </label>
                    <label>
                        <input type="checkbox" id="case-sensitive" onchange="searchMessages()">
                        <i class="fas fa-font"></i> 대소문자 구분
                    </label>
                    <label>
                        <input type="checkbox" id="whole-word" onchange="searchMessages()">
                        <i class="fas fa-signature"></i> 전체 단어만
                    </label>
                </div>

                <div class="category-container" role="group" aria-label="카테고리 필터">
                    <button class="active" data-category="전체" aria-pressed="true">전체</button>
                    <button data-category="천성경" aria-pressed="false">천성경</button>
                    <button data-category="통일원리" aria-pressed="false">통일원리</button>
                    <button data-category="성경" aria-pressed="false">성경</button>
                    <button data-category="평화메시지" aria-pressed="false">평화메시지</button>
                    <button data-category="기타" aria-pressed="false">기타</button>
                </div>

                <div id="search-stats" class="search-stats" style="display: none;" role="status" aria-live="polite"></div>
                <div id="search-loading" class="loading" style="display: none;" aria-live="assertive" aria-atomic="true">
                    <div class="spinner" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="검색 중"></div>
                    검색 중...
                </div>
                <div id="search-results" class="search-results" role="list"></div>
            </div>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <p>© 2025 세계평화통일가정연합 - 원리강론 퀴즈 WebApp. All rights reserved.</p>
    </footer>

<script>
let messages = [];
let currentCategory = '전체';
let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
let debounceTimeout;
let categoryToggled = null;

// JSON 데이터 로드 (기존과 동일)
async function loadMessages() {
    const loading = document.getElementById('search-loading');
    const resultsContainer = document.getElementById('search-results');
    const statsContainer = document.getElementById('search-stats');
    loading.style.display = 'flex';
    resultsContainer.innerHTML = '';
    statsContainer.style.display = 'none';

    try {
        const response = await fetch('messages.json');
        if (!response.ok) throw new Error('Failed to load messages.json');
        messages = await response.json();
    } catch (error) {
        console.error('Error loading messages:', error);
        resultsContainer.innerHTML = '<p class="no-results" role="alert">메시지를 로드하는 데 실패했습니다. 네트워크 연결을 확인하거나 나중에 다시 시도해주세요.</p>';
    } finally {
        loading.style.display = 'none';
    }
}

// 검색어 하이라이트 함수
function highlightText(text, query, isCaseSensitive, isWholeWord) {
    if (!query) return text;
    let regex;
    try {
        const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        // 기본적으로 단어 경계를 적용, isWholeWord가 false면 부분 일치 허용
        let pattern = isWholeWord ? `\\b${escapedQuery}\\b` : escapedQuery;
        regex = new RegExp(pattern, isCaseSensitive ? 'g' : 'gi');
    } catch (e) {
        console.warn('Invalid regex query, returning original text:', e);
        return text;
    }
    return text.replace(regex, match => `<span class="highlight">${match}</span>`);
}

// 검색 함수 (디바운스 적용)
function searchMessages() {
    clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
        const query = document.getElementById('search-input').value.trim();
        const isExactMatch = document.getElementById('exact-match').checked;
        const isCaseSensitive = document.getElementById('case-sensitive').checked;
        const isWholeWord = document.getElementById('whole-word').checked;
        const resultsContainer = document.getElementById('search-results');
        const statsContainer = document.getElementById('search-stats');
        const loading = document.getElementById('search-loading');

        if (!query && categoryToggled === null) {
            resultsContainer.innerHTML = '';
            statsContainer.style.display = 'none';
            loading.style.display = 'none';
            return;
        }

        loading.style.display = 'flex';
        resultsContainer.innerHTML = '';
        statsContainer.style.display = 'none';

        const startTime = performance.now();
        let filteredMessages = messages;

        // 카테고리 필터링
        if (currentCategory !== '전체' && categoryToggled !== null) {
            filteredMessages = filteredMessages.filter(msg => msg.category === currentCategory);
        }

        // 검색어 필터링 및 하이라이트
        if (query) {
            filteredMessages = filteredMessages.filter(msg => {
                const textToSearch = isCaseSensitive ? msg.text : msg.text.toLowerCase();
                const searchQuery = isCaseSensitive ? query : query.toLowerCase();

                // 기본적으로 단어 경계 매칭 적용
                const wordRegex = new RegExp(`\\b${searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, isCaseSensitive ? '' : 'i');
                
                if (isWholeWord) {
                    // "전체 단어만" 체크 시 단어 경계 필수
                    return wordRegex.test(textToSearch);
                } else if (isExactMatch) {
                    // 정확한 단어 일치 시 단어 경계 없이 정확한 문자열 포함
                    return textToSearch.includes(searchQuery);
                } else {
                    // 부분 일치 허용 (단어 경계 없이)
                    return textToSearch.includes(searchQuery);
                }
            });
        }

        // 검색 기록 저장
        if (query && !searchHistory.includes(query)) {
            searchHistory.unshift(query);
            if (searchHistory.length > 5) searchHistory.pop();
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        }

        // 결과 렌더링
        const endTime = performance.now();
        const searchTime = (endTime - startTime).toFixed(2);

        if (filteredMessages.length === 0) {
            resultsContainer.innerHTML = '<p class="no-results" role="alert">검색 결과가 없습니다. 다른 검색어나 카테고리를 시도해 보세요.</p>';
        } else {
            resultsContainer.innerHTML = filteredMessages.map(msg => {
                const highlightedText = query ? highlightText(msg.text, query, isCaseSensitive, isWholeWord) : msg.text;
                let matchCount = 0;
                if (query) {
                    const queryRegex = new RegExp(isWholeWord ? `\\b${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b` : query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), isCaseSensitive ? 'g' : 'gi');
                    matchCount = (msg.text.match(queryRegex) || []).length;
                }
                const sourceDisplay = msg.reference ? `${msg.source}, ${msg.reference}` : msg.source;
                return `
                    <div class="result-item ${matchCount > 0 ? 'highlighted' : ''}" role="listitem">
                        <p>${highlightedText} ${matchCount > 0 ? `<span class="match-count" aria-label="일치 횟수 ${matchCount}회">${matchCount}</span>` : ''}</p>
                        <p class="source"><i class="fas fa-book" aria-hidden="true"></i> ${sourceDisplay}</p>
                    </div>
                `;
            }).join('');
        }

        statsContainer.style.display = 'block';
        statsContainer.innerHTML = `검색 결과: ${filteredMessages.length}개 (소요 시간: ${searchTime}ms)`;
        loading.style.display = 'none';
    }, 300);
}

// 검색 초기화 함수
function clearSearch() {
    document.getElementById('search-input').value = '';
    document.getElementById('exact-match').checked = false;
    document.getElementById('case-sensitive').checked = false;
    document.getElementById('whole-word').checked = false;
    document.querySelectorAll('.category-container button').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
        if (btn.getAttribute('data-category') === '전체') {
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
        }
    });
    currentCategory = '전체';
    categoryToggled = null;
    const resultsContainer = document.getElementById('search-results');
    const statsContainer = document.getElementById('search-stats');
    resultsContainer.innerHTML = '';
    statsContainer.style.display = 'none';
}

// 페이지 전환 함수
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.querySelector(`#${pageId}`).classList.add('active');

    document.querySelectorAll('.nav-bar button').forEach(button => {
        button.classList.remove('active');
        button.setAttribute('aria-current', 'false');
    });
    const activeButton = document.querySelector(`.nav-bar button[data-page="${pageId}"]`);
    if (activeButton) {
        activeButton.classList.add('active');
        activeButton.setAttribute('aria-current', 'page');
    }

    if (pageId === 'workbook' && messages.length === 0) {
        loadMessages();
        const resultsContainer = document.getElementById('search-results');
        const statsContainer = document.getElementById('search-stats');
        resultsContainer.innerHTML = '';
        statsContainer.style.display = 'none';
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// 퀴즈 시작 함수
function startQuiz(type) {
    if (type === '원리강론') {
        window.location.href = 'divine.html';
    } else if (type === '성경') {
        window.location.href = 'bible.html';
    }
}

// 이벤트 리스너 설정
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.nav-bar button').forEach(button => {
        button.addEventListener('click', () => {
            const pageId = button.getAttribute('data-page');
            showPage(pageId);
        });
    });

    document.querySelectorAll('.category-container button').forEach(button => {
        button.addEventListener('click', () => {
            const category = button.getAttribute('data-category');
            if (categoryToggled === category) {
                document.querySelectorAll('.category-container button').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                    if (btn.getAttribute('data-category') === '전체') {
                        btn.classList.add('active');
                        btn.setAttribute('aria-pressed', 'true');
                    }
                });
                currentCategory = '전체';
                categoryToggled = null;
                const resultsContainer = document.getElementById('search-results');
                const statsContainer = document.getElementById('search-stats');
                resultsContainer.innerHTML = '';
                statsContainer.style.display = 'none';
            } else {
                document.querySelectorAll('.category-container button').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                });
                button.classList.add('active');
                button.setAttribute('aria-pressed', 'true');
                currentCategory = category;
                categoryToggled = category;
                searchMessages();
            }
        });
    });

    document.getElementById('search-input').addEventListener('input', searchMessages);
    document.getElementById('exact-match').addEventListener('change', searchMessages);
    document.getElementById('case-sensitive').addEventListener('change', searchMessages);
    document.getElementById('whole-word').addEventListener('change', searchMessages);

    document.querySelectorAll('button').forEach(element => {
        element.addEventListener('touchstart', () => {
            element.classList.add('active-touch');
            element.style.transform = 'scale(0.95)';
        }, { passive: true });
        element.addEventListener('touchend', () => {
            element.classList.remove('active-touch');
            element.style.transform = '';
        }, { passive: true });
        element.addEventListener('touchcancel', () => {
            element.classList.remove('active-touch');
            element.style.transform = '';
        }, { passive: true });
    });

    document.getElementById('search-input').addEventListener('keydown', e => {
        if (e.key === 'Enter') {
            searchMessages();
        }
    });

    showPage('home');
});

const style = document.createElement('style');
style.innerHTML = `
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
    .active-touch {
        transform: scale(0.95);
        box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.2);
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>